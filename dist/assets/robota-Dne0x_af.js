import{s as w}from"./constants-Dk2L_Z7X.js";import{b as m,c as L}from"./main-DmbpKIz5.js";import"./supabase-Bwo9M3wC.js";import"./pdf-D8mvdlm6.js";let u=[],f=null,g=[],y=0;const D={Робота:{table:"works",field:"data"}},_=(e,s=!1)=>{if(!e.trim())return;if(!f){m(null);return}const{table:r,field:a,deepPath:i,needsJsonParsing:o}=f;let l=!1;if(u&&u.length>0)for(const t of u){let d=t;if(o&&typeof t[a]=="string")try{d={...t,[a]:JSON.parse(t[a])}}catch{continue}let n;if(i?n=((h,b)=>b.reduce((c,p)=>c&&c[p]!==void 0?c[p]:void 0,h))(d[a],i):(n=o||typeof t[a]=="object"?d[a]:t[a],typeof n=="object"?n=JSON.stringify(n):typeof n!="string"&&(n=String(n))),(n==null?void 0:n.trim())===e.trim()){l=!0;const h=`${r.endsWith("s")?r.slice(0,-1):r}_id`,b=t[h]!==void 0?t[h]:null;let c;if(o&&typeof t[a]=="string")try{c=JSON.parse(t[a])}catch{c=t[a]}else c=t[a];const p={table:r,[h]:b,data:typeof c=="object"&&!Array.isArray(c)?c:{[a]:c}};m(JSON.stringify(p,null,2));return}}if(!l&&s){const d=`${r.endsWith("s")?r.slice(0,-1):r}_id`,n={table:r,[d]:null,data:{[a]:e.trim()}};m(JSON.stringify(n,null,2))}};async function N(e,s,r){try{const{data:a,error:i}=await w.from(e).select("*").ilike(s,`%${r}%`).limit(200);if(i||!a)return console.error(`Помилка завантаження з ${e}:`,i),{options:[],fullData:[]};const o=new Set;return a.forEach(l=>{const t=l[s];if(t!=null){const d=String(t).trim();d&&o.add(d)}}),{options:Array.from(o).sort(),fullData:a}}catch(a){return console.error(`Помилка при запиті до ${e}:`,a),{options:[],fullData:[]}}}const S=e=>{const s=document.getElementById("custom-dropdown-all_other_bases");if(!s||!e)return;const r=async i=>{if(s.innerHTML="",!f)return;const o=i.length;if(o<y||o>=3){const l=await N(f.table,f.field,i);g=l.options,u=l.fullData}else if(o<3){g=[],u=[],s.classList.add("hidden-all_other_bases"),y=o;return}if(y=o,g.length===0){s.classList.add("hidden-all_other_bases");return}g.forEach(l=>{const t=document.createElement("div");t.className="custom-dropdown-item",t.textContent=l,t.addEventListener("click",()=>{e.value=l,s.classList.add("hidden-all_other_bases"),_(l,!0)}),s.appendChild(t)}),s.classList.remove("hidden-all_other_bases")};e.addEventListener("input",async()=>{await r(e.value.trim()),_(e.value.trim(),!1)}),e.addEventListener("focus",async()=>{await r(e.value.trim())}),document.addEventListener("click",i=>{!s.contains(i.target)&&i.target!==e&&s.classList.add("hidden-all_other_bases")});const a=e.getBoundingClientRect();s.style.minWidth=`${a.width}px`},O=async e=>{const s=D[e];if(s){f=s,g=[],y=0,u=[];try{const r=document.getElementById("search-input-all_other_bases");r&&(r.value=""),m(JSON.stringify({config:s,table:s.table,input:""},null,2)),L(e,s.table),S(r)}catch(r){console.error(`Помилка завантаження з ${e}`,r)}}},A=async()=>{await O("Робота")},C=()=>{console.log("Ініціалізовано модуль роботи")};export{A as handleRobotaClick,C as initRobota};
