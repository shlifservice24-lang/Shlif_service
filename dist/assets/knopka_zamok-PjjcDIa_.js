import{s as _}from"./constants-BQ5Hn_-k.js";import{b as f,c as q,g as $,d as B,e as K,r as E,f as M,h as j,j as D,k as O,m as P,Z as V,n as U,A as k}from"./main-BSGgneU5.js";import"./supabase-Bwo9M3wC.js";import"./pdf-D8mvdlm6.js";function R(e){return new Promise(o=>{const s=document.createElement("div");s.className="slusar-confirm-overlay";const a=document.createElement("div");a.className="slusar-confirm-modal";const t=document.createElement("div");t.className="slusar-confirm-message",t.textContent=e;const l=document.createElement("div");l.className="slusar-confirm-buttons";const r=document.createElement("button");r.className="slusar-confirm-btn slusar-confirm-ok",r.textContent="–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏",r.onclick=()=>{document.body.removeChild(s),o(!0)};const i=document.createElement("button");i.className="slusar-confirm-btn slusar-confirm-cancel",i.textContent="–í—ñ–¥–º—ñ–Ω–∏—Ç–∏",i.onclick=()=>{document.body.removeChild(s),o(!1)},l.appendChild(r),l.appendChild(i),a.appendChild(t),a.appendChild(l),s.appendChild(a),document.body.appendChild(s),setTimeout(()=>r.focus(),100);const n=c=>{c.key==="Escape"&&(document.body.removeChild(s),document.removeEventListener("keydown",n),o(!1))};document.addEventListener("keydown",n)})}async function Z(e,o,s,a,t,l){try{console.log(`üìù [SlusarNotification] –ó–∞–ø–∏—Å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: –∞–∫—Ç #${e}, slusarsOn=${s}`);const r={act_id:e,act_number:o,completed_by_surname:a,completed_by_name:t||null,pruimalnyk:l||null,viewed:!1,delit:!1,data:new Date().toISOString()},{error:i}=await _.from("slusar_complete_notifications").insert([r]);if(i)throw console.error("‚ùå [SlusarNotification] –ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Å—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:",i),new Error(`–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–ø–∏—Å–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: ${i.message}`);console.log(`‚úÖ [SlusarNotification] –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–æ –¥–ª—è –∞–∫—Ç—É #${e}`)}catch(r){throw console.error("‚ùå [SlusarNotification] –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞:",r),r}}async function H(e){try{console.log(`üóëÔ∏è [SlusarNotification] –ü—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –¥–ª—è –∞–∫—Ç—É #${e}`);const{error:o}=await _.from("slusar_complete_notifications").update({delit:!0}).eq("act_id",e).eq("delit",!1);if(o){console.error("‚ùå [SlusarNotification] –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å:",o);return}console.log(`‚úÖ [SlusarNotification] –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ –¥–ª—è –∞–∫—Ç—É #${e}`)}catch(o){console.error("‚ùå [SlusarNotification] –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞:",o)}}function N(e){return(e??"").replace(/\u00A0/g," ").trim()}function C(e){const o=N(e).replace(/\s/g,"").replace(",","."),s=parseFloat(o);return isFinite(s)?s:0}function A(e){if(!e)return null;const o=new Date(e);if(isNaN(+o))return null;const s=o.getFullYear(),a=String(o.getMonth()+1).padStart(2,"0"),t=String(o.getDate()).padStart(2,"0");return`${s}-${a}-${t}`}async function v(e){const{data:o,error:s}=await _.from("acts").select("date_on, date_off").eq("act_id",e).single();return s?(console.warn("–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –¥–∞—Ç–∏ –∞–∫—Ç—É:",s.message),{date_on:null,date_off:null}):{date_on:(o==null?void 0:o.date_on)??null,date_off:(o==null?void 0:o.date_off)??null}}async function W(e){if(e.length===0)return new Map;const{data:o,error:s}=await _.from("sclad").select("sclad_id, rahunok, time_off").in("sclad_id",Array.from(new Set(e)));if(s)return console.warn("fetchScladMeta():",s.message),new Map;const a=new Map;for(const t of o||[])a.set(Number(t.sclad_id),{rahunok:t.rahunok??null,time_off:t.time_off??null});return a}async function J(e){const{data:o,error:s}=await _.from("shops").select("shop_id, data").eq("data->>Name",e).maybeSingle();return s?(console.warn(`fetchShopByName(${e}):`,s.message),null):o?{shop_id:o.shop_id,data:o.data}:null}async function Y(e){if(!e.shop_id)return;const{error:o}=await _.from("shops").update({data:e.data}).eq("shop_id",e.shop_id);if(o)throw new Error(`–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–Ω–æ–≤–∏—Ç–∏ shops#${e.shop_id}: ${o.message}`)}function G(e){return(!e.data||typeof e.data!="object")&&(e.data={}),(!e.data.–Ü—Å—Ç–æ—Ä—ñ—è||typeof e.data.–Ü—Å—Ç–æ—Ä—ñ—è!="object")&&(e.data.–Ü—Å—Ç–æ—Ä—ñ—è={}),e.data.–Ü—Å—Ç–æ—Ä—ñ—è}function I(){const e=[];return document.querySelectorAll(`#${k} tbody tr`).forEach(s=>{const a=s.querySelector('[data-name="name"]');if(!a)return;let t=a.getAttribute("data-type");const l=N(a.textContent);if(!l)return;if(!t||t!=="details"&&t!=="works"){const h=new Set($.works).has(l),b=new Set($.details).has(l);t=h&&!b?"works":"details",a.setAttribute("data-type",t)}if(t!=="details")return;const r=s.querySelector('[data-name="id_count"]'),i=s.querySelector('[data-name="price"]'),n=s.querySelector('[data-name="catalog"]'),c=s.querySelector('[data-name="pib_magazin"]'),p=N(n==null?void 0:n.textContent)||null,g=C(r==null?void 0:r.textContent),m=C(i==null?void 0:i.textContent),d=N(c==null?void 0:c.textContent),w=n==null?void 0:n.getAttribute("data-sclad-id"),y=w?Number(w):null;e.push({shopName:d,sclad_id:y,–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è:l,–ö–∞—Ç–∞–ª–æ–≥:p,–ö—ñ–ª—å–∫—ñ—Å—Ç—å:g,–¶—ñ–Ω–∞:m})}),e}function Q(){const e=[];return document.querySelectorAll(`#${k} tbody tr`).forEach(s=>{const a=s.querySelector('[data-name="name"]');if(!a)return;let t=a.getAttribute("data-type");const l=N(a.textContent);if(!l)return;if(!t||t!=="details"&&t!=="works"){const w=new Set($.works).has(l),y=new Set($.details).has(l);t=w&&!y?"works":"details",a.setAttribute("data-type",t)}if(t!=="works")return;const r=s.querySelector('[data-name="id_count"]'),i=s.querySelector('[data-name="price"]'),n=s.querySelector('[data-name="slyusar_sum"]'),c=s.querySelector('[data-name="pib_magazin"]'),p=C(r==null?void 0:r.textContent),g=C(i==null?void 0:i.textContent),m=C(n==null?void 0:n.textContent),d=N(c==null?void 0:c.textContent);e.push({slyusarName:d,–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è:l,–ö—ñ–ª—å–∫—ñ—Å—Ç—å:p,–¶—ñ–Ω–∞:g,–ó–∞—Ä–ø–ª–∞—Ç–∞:m})}),e}function X(){const e=[],o=I(),s=Q();for(const a of s){const t=`"${a.–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è}"`;(!a.–ö—ñ–ª—å–∫—ñ—Å—Ç—å||a.–ö—ñ–ª—å–∫—ñ—Å—Ç—å===0)&&e.push(`–†–æ–±–æ—Ç–∞ ${t}: –ö-—Ç—å - –Ω–µ –ø–æ—Ä–æ–∂–Ω—ñ–π —ñ –Ω–µ –¥–æ—Ä—ñ–≤–Ω—é—î 0`),(!a.–¶—ñ–Ω–∞||a.–¶—ñ–Ω–∞===0)&&e.push(`–†–æ–±–æ—Ç–∞ ${t}: –¶—ñ–Ω–∞ - –Ω–µ –ø–æ—Ä–æ–∂–Ω—è —ñ –Ω–µ –¥–æ—Ä—ñ–≤–Ω—é—î 0`);const l=a.–ö—ñ–ª—å–∫—ñ—Å—Ç—å*a.–¶—ñ–Ω–∞;(!l||l===0)&&e.push(`–†–æ–±–æ—Ç–∞ ${t}: –°—É–º–∞ - –Ω–µ –ø–æ—Ä–æ–∂–Ω—è —ñ –Ω–µ –¥–æ—Ä—ñ–≤–Ω—é—î 0`);const r=document.querySelector(`#${k} tbody tr [data-name="slyusar_sum"]`);r&&r.offsetParent!==null&&(!a.–ó–∞—Ä–ø–ª–∞—Ç–∞||a.–ó–∞—Ä–ø–ª–∞—Ç–∞===0)&&e.push(`–†–æ–±–æ—Ç–∞ ${t}: –ó–∞—Ä-—Ç–∞ - –Ω–µ –ø–æ—Ä–æ–∂–Ω—è —ñ –Ω–µ –¥–æ—Ä—ñ–≤–Ω—é—î 0`);const i=document.querySelector(`#${k} tbody tr [data-name="pib_magazin"]`);i&&i.offsetParent!==null&&(!a.slyusarName||a.slyusarName.trim()==="")&&e.push(`–†–æ–±–æ—Ç–∞ ${t}: –ü–Ü–ë (–°–ª—é—Å–∞—Ä) - –Ω–µ –ø–æ—Ä–æ–∂–Ω—ñ–π`)}for(const a of o){const t=`"${a.–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è}"`;(!a.–ö—ñ–ª—å–∫—ñ—Å—Ç—å||a.–ö—ñ–ª—å–∫—ñ—Å—Ç—å===0)&&e.push(`–î–µ—Ç–∞–ª—å ${t}: –ö-—Ç—å - –Ω–µ –ø–æ—Ä–æ–∂–Ω—ñ–π —ñ –Ω–µ –¥–æ—Ä—ñ–≤–Ω—é—î 0`),(!a.–¶—ñ–Ω–∞||a.–¶—ñ–Ω–∞===0)&&e.push(`–î–µ—Ç–∞–ª—å ${t}: –¶—ñ–Ω–∞ - –Ω–µ –ø–æ—Ä–æ–∂–Ω—è —ñ –Ω–µ –¥–æ—Ä—ñ–≤–Ω—é—î 0`);const l=a.–ö—ñ–ª—å–∫—ñ—Å—Ç—å*a.–¶—ñ–Ω–∞;(!l||l===0)&&e.push(`–î–µ—Ç–∞–ª—å ${t}: –°—É–º–∞ - –Ω–µ –ø–æ—Ä–æ–∂–Ω—è —ñ –Ω–µ –¥–æ—Ä—ñ–≤–Ω—é—î 0`);const r=document.querySelector(`#${k} tbody tr [data-name="pib_magazin"]`);r&&r.offsetParent!==null&&(!a.shopName||a.shopName.trim()==="")&&e.push(`–î–µ—Ç–∞–ª—å ${t}: –ü–Ü–ë_–ú–∞–≥–∞–∑–∏–Ω - –Ω–µ –ø–æ—Ä–æ–∂–Ω—ñ–π`)}return{isValid:e.length===0,errors:e}}async function F(e){const o=new Map,s=[];for(const r of e.detailRows){const i=(r.shopName||"").trim();i&&(r.sclad_id&&s.push(r.sclad_id),o.has(i)||o.set(i,[]),o.get(i).push({sclad_id:r.sclad_id,–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è:r.–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è,–ö–∞—Ç–∞–ª–æ–≥:r.–ö–∞—Ç–∞–ª–æ–≥,–ö—ñ–ª—å–∫—ñ—Å—Ç—å:r.–ö—ñ–ª—å–∫—ñ—Å—Ç—å,–¶—ñ–Ω–∞:r.–¶—ñ–Ω–∞}))}const a=await W(s),{date_off:t}=await v(e.actId),l=A(t);for(const[r,i]of o.entries()){const n=await J(r);if(!n){f(`–ú–∞–≥–∞–∑–∏–Ω "${r}" –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ —É shops ‚Äî –ø—Ä–æ–ø—É—â–µ–Ω–æ`,"warning",1800);continue}const c=[];for(const d of i){const w=d.sclad_id&&a.get(d.sclad_id)||null;c.push({sclad_id:d.sclad_id,–ö–∞—Ç–∞–ª–æ–≥:d.–ö–∞—Ç–∞–ª–æ–≥?isNaN(Number(d.–ö–∞—Ç–∞–ª–æ–≥))?d.–ö–∞—Ç–∞–ª–æ–≥:Number(d.–ö–∞—Ç–∞–ª–æ–≥):null,–¶—ñ–Ω–∞:Number(d.–¶—ñ–Ω–∞)||0,–†–∞—Ö—É–Ω–æ–∫:w?w.rahunok??null:null,–ö—ñ–ª—å–∫—ñ—Å—Ç—å:Number(d.–ö—ñ–ª—å–∫—ñ—Å—Ç—å)||0,–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è:d.–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è})}const p=G(n);p[e.dateKey]||(p[e.dateKey]=[]);const g=p[e.dateKey];let m=g.find(d=>Number(d==null?void 0:d.–ê–∫—Ç)===Number(e.actId));m||(m={–ê–∫—Ç:e.actId,–î–µ—Ç–∞–ª—ñ:[],–î–∞—Ç–∞–ó–∞–∫—Ä–∏—Ç—Ç—è:l??null},g.push(m)),m.–î–µ—Ç–∞–ª—ñ=c,m.–î–∞—Ç–∞–ó–∞–∫—Ä–∏—Ç—Ç—è=l??null,await Y(n)}}async function x(e){try{console.log(`üîç –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è slyusars –¥–ª—è –∞–∫—Ç—É ${e.actId}, –¥–∞—Ç–∞ –∑–∞–∫—Ä–∏—Ç—Ç—è: ${e.dateClose}`);const{data:o,error:s}=await _.from("slyusars").select("*");if(s){console.warn("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –∑ slyusars:",s.message);return}if(!o||o.length===0){console.log("–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö —É —Ç–∞–±–ª–∏—Ü—ñ slyusars");return}console.log(`üìä –ó–Ω–∞–π–¥–µ–Ω–æ ${o.length} –∑–∞–ø–∏—Å—ñ–≤ —É —Ç–∞–±–ª–∏—Ü—ñ slyusars`);const a=Object.keys(o[0]||{});console.log("üîë –î–æ—Å—Ç—É–ø–Ω—ñ –∫–ª—é—á—ñ –≤ —Ç–∞–±–ª–∏—Ü—ñ slyusars:",a);const t=["slyusar_id","id","slyusars_id","uid","pk"];let l=null;for(const n of t)if(a.includes(n)){l=n,console.log(`‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ –ø–µ—Ä–≤–∏–Ω–Ω–∏–π –∫–ª—é—á: "${l}"`);break}if(!l){console.error("‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ø–µ—Ä–≤–∏–Ω–Ω–∏–π –∫–ª—é—á –¥–ª—è slyusars"),console.error("üí° –î–æ—Å—Ç—É–ø–Ω—ñ –∫–ª—é—á—ñ:",a),console.error("üí° –®—É–∫–∞–ª–∏:",t);return}console.log(`üîë –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø–µ—Ä–≤–∏–Ω–Ω–∏–π –∫–ª—é—á: ${l}`);let r=0,i=0;for(const n of o){let c={};if(typeof n.data=="string")try{c=JSON.parse(n.data)}catch{console.warn(`‚ö†Ô∏è –ù–µ –≤–¥–∞–ª–æ—Å—è —Ä–æ–∑–ø–∞—Ä—Å–∏—Ç–∏ –¥–∞–Ω—ñ –¥–ª—è –∑–∞–ø–∏—Å—É ${n[l]}`);continue}else if(typeof n.data=="object"&&n.data!==null)c=n.data;else{console.warn(`‚ö†Ô∏è –ù–µ–≤–∞–ª—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è –∑–∞–ø–∏—Å—É ${n[l]}`);continue}const p=c.–î–æ—Å—Ç—É–ø||"";if(p.toLowerCase().normalize("NFKC").trim()!=="–ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫"){console.log(`‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ ${c.Name||"–ù–µ–≤—ñ–¥–æ–º–∏–π"} - —Ä–æ–ª—å: ${p}`);continue}if(i++,console.log(`üë§ –ó–Ω–∞–π–¥–µ–Ω–æ –ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫–∞: ${c.Name}`),!c.–Ü—Å—Ç–æ—Ä—ñ—è||typeof c.–Ü—Å—Ç–æ—Ä—ñ—è!="object"){console.log(`‚ö†Ô∏è –£ –ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫–∞ ${c.Name} –Ω–µ–º–∞—î —ñ—Å—Ç–æ—Ä—ñ—ó`);continue}const m=c.–Ü—Å—Ç–æ—Ä—ñ—è,d=Object.keys(m);console.log(`üìÖ –î–∞—Ç–∏ –≤ —ñ—Å—Ç–æ—Ä—ñ—ó ${c.Name}: ${d.join(", ")}`);let w=!1,y="";for(const h in m){if(!Array.isArray(m[h])){console.log(`‚ö†Ô∏è –Ü—Å—Ç–æ—Ä—ñ—è –∑–∞ –¥–∞—Ç–æ—é ${h} –Ω–µ —î –º–∞—Å–∏–≤–æ–º`);continue}const b=m[h];console.log(`üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –¥–∞—Ç—É ${h} - –∞–∫—Ç—ñ–≤: ${b.length}`);for(const u of b){const S=u==null?void 0:u.–ê–∫—Ç;if(console.log(`  üìã –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∞–∫—Ç: ${S} (—à—É–∫–∞—î–º–æ ${e.actId})`),Number(S)===Number(e.actId)){console.log(`‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ –∞–∫—Ç ${e.actId} —É –ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫–∞ ${c.Name} –∑–∞ –¥–∞—Ç–æ—é ${h}`),console.log(`   –ü–æ—Ç–æ—á–Ω–∞ –î–∞—Ç–∞–ó–∞–∫—Ä–∏—Ç—Ç—è: ${u.–î–∞—Ç–∞–ó–∞–∫—Ä–∏—Ç—Ç—è}`),console.log(`   –ù–æ–≤–∞ –î–∞—Ç–∞–ó–∞–∫—Ä–∏—Ç—Ç—è: ${e.dateClose}`),u.–î–∞—Ç–∞–ó–∞–∫—Ä–∏—Ç—Ç—è=e.dateClose,w=!0,y=h;break}}if(w)break}if(w){console.log(`üíæ –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –∑–º—ñ–Ω–∏ –¥–ª—è ${c.Name}`);const{error:h}=await _.from("slyusars").update({data:c}).eq(l,n[l]);h?console.error(`‚ùå –ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è slyusars#${n[l]}:`,h.message):(r++,console.log(`‚úÖ –û–Ω–æ–≤–ª–µ–Ω–æ –î–∞—Ç–∞–ó–∞–∫—Ä–∏—Ç—Ç—è="${e.dateClose}" –¥–ª—è –∞–∫—Ç—É ${e.actId} —É –ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫–∞ ${c.Name} (–¥–∞—Ç–∞: ${y})`))}else console.log(`‚ö†Ô∏è –ê–∫—Ç ${e.actId} –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ —ñ—Å—Ç–æ—Ä—ñ—ó –ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫–∞ ${c.Name}`)}console.log(`üìä –ü—ñ–¥—Å—É–º–æ–∫: –∑–Ω–∞–π–¥–µ–Ω–æ ${i} –ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫—ñ–≤, –æ–Ω–æ–≤–ª–µ–Ω–æ ${r}`),r>0?(console.log(`‚úÖ –û–Ω–æ–≤–ª–µ–Ω–æ ${r} –∑–∞–ø–∏—Å—ñ–≤ —É slyusars –¥–ª—è –∞–∫—Ç—É ${e.actId}`),f(`‚úÖ –Ü—Å—Ç–æ—Ä—ñ—è –ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–∞ (${r})`,"success",2e3)):(console.warn(`‚ö†Ô∏è –ê–∫—Ç ${e.actId} –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ —ñ—Å—Ç–æ—Ä—ñ—ó –∂–æ–¥–Ω–æ–≥–æ –ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫–∞`),f(`‚ö†Ô∏è –ê–∫—Ç ${e.actId} –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ —É –ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫—ñ–≤`,"info",3e3))}catch(o){console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó slyusars:",o),f("‚ùå –ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó —ñ—Å—Ç–æ—Ä—ñ—ó –ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫–∞","error")}}const ee=["–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä","–∞–¥–º—ñ–Ω—ñ—Å—Ç–∞—Ç–æ—Ä","full","admin","administrator"];function te(){var a;const e=(typeof q=="string"?q:"")||"",o=((a=K)==null?void 0:a())||null;return(e||(o==null?void 0:o.access)||(o==null?void 0:o.–î–æ—Å—Ç—É–ø)||"").toString().normalize("NFKC").trim().toLowerCase()}function z(){return ee.includes(te())}let L=!1;function re(){L||(L=!0,document.addEventListener("click",async e=>{var l,r,i;const o=e.target,s=(l=o==null?void 0:o.closest)==null?void 0:l.call(o,"#status-lock-btn");if(!s)return;const a=s.getAttribute("data-act-id"),t=a?Number(a):NaN;if(!Number.isFinite(t)){console.error("data-act-id –Ω–∞ –∫–Ω–æ–ø—Ü—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π/–Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π"),f("–ü–æ–º–∏–ª–∫–∞: –Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ ID –∞–∫—Ç—É","error");return}if(!s.disabled){s.disabled=!0;try{if(q==="–°–ª—é—Å–∞—Ä"){if($.isActClosed){f("–ê–∫—Ç –∑–∞–∫—Ä–∏—Ç–∏–π. –£ –í–∞—Å –≤—ñ–¥—Å—É—Ç–Ω—ñ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –Ω–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.","warning",4e3),s.disabled=!1;return}let n=!1;try{n=await B()}catch(u){console.error("–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–∞–≤ –°–ª—é—Å–∞—Ä—è:",u)}if(!n){f("‚ùå –£ –≤–∞—Å –Ω–µ–º–∞—î –ø—Ä–∞–≤–∞ –¥–ª—è —Ü—ñ—î—ó —Ñ—É–Ω–∫—Ü—ñ—ó. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.","warning",4e3),s.disabled=!1;return}const{data:c,error:p}=await _.from("acts").select("slusarsOn, pruimalnyk").eq("act_id",t).single();if(p){console.error("–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∞–∫—Ç—É:",p),f("–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—Ç–∞–Ω—É –∞–∫—Ç—É","error"),s.disabled=!1;return}const g=(c==null?void 0:c.slusarsOn)===!0,m=String(t),d=c==null?void 0:c.pruimalnyk;let w=!1;if(g?w=await R("–í—ñ–¥–º—ñ–Ω–∏—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–±—ñ—Ç?"):w=await R("–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤—Å—ñ—Ö —Ä–æ–±—ñ—Ç?"),!w){f("–°–∫–∞—Å–æ–≤–∞–Ω–æ","warning"),s.disabled=!1;return}const y=!g,{error:h}=await _.from("acts").update({slusarsOn:y}).eq("act_id",t);if(h){console.error("–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è slusarsOn:",h),f("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è","error"),s.disabled=!1;return}try{const u=(r=K)==null?void 0:r(),S=(u==null?void 0:u.name)||"–ù–µ–≤—ñ–¥–æ–º–∏–π",T=S.split(" ")[0]||S;await Z(t,m,y,T,S,d),console.log(`‚úÖ Push-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è –∞–∫—Ç—É #${t}`)}catch(u){console.error("‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ):",u)}const b=document.querySelector(".zakaz_narayd-header");b&&(y?b.classList.add("zakaz_narayd-header-slusar-on"):b.classList.remove("zakaz_narayd-header-slusar-on")),E(),f(y?"‚úÖ –†–æ–±–æ—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ":"‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–±—ñ—Ç –≤—ñ–¥–º—ñ–Ω–µ–Ω–æ","success",2e3),s.disabled=!1;return}if($.isActClosed){let n=!0;if(!z()){try{n=await M()}catch(y){console.error("–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–∞–≤ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É:",y),n=!1}if(!n){f("‚ùå –£ –≤–∞—Å —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.","warning",4e3),s.disabled=!1;return}}if(!await j(t)){f("–°–∫–∞—Å–æ–≤–∞–Ω–æ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É","warning"),s.disabled=!1;return}f("–í—ñ–¥–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É...","info");const{data:p,error:g}=await _.from("sclad").select("sclad_id").eq("akt",t);if(g)throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞–ø–∏—Å–∏ —Å–∫–ª–∞–¥—É: "+g.message);if(p&&p.length>0){const{error:y}=await _.from("sclad").update({time_off:null}).eq("akt",t);if(y)throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—á–∏—Å—Ç–∏—Ç–∏ time_off: "+y.message)}const{error:m}=await _.from("acts").update({date_off:null,tupOplatu:null}).eq("act_id",t);if(m)throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ –∞–∫—Ç: "+m.message);const{date_on:d}=await v(t),w=A(d);if(w){const y=I();y.length&&await F({actId:t,dateKey:w,detailRows:y}),await x({actId:t,dateKey:w,dateClose:null})}else f("–ù–µ –≤–¥–∞–ª–æ—Å—å –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –¥–∞—Ç—É –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É ‚Äî –Ü—Å—Ç–æ—Ä—ñ—è –≤ shops –Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–∞","warning",2e3);$.isActClosed=!1,await D(),await O(t),E(),f("–ê–∫—Ç —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–∫—Ä–∏—Ç–æ","success")}else{let n=!0;if(!z()){try{n=await P()}catch(u){console.error("–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–∞–≤ –∑–∞–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É:",u),n=!0}if(!n){f("–£ –≤–∞—Å –Ω–µ–º–∞—î –ø—Ä–∞–≤–∞ –∑–∞–∫—Ä–∏–≤–∞—Ç–∏ –∞–∫—Ç–∏. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.","warning",4e3),s.disabled=!1;return}}const c=X();if(!c.isValid){f("‚ùå –ó–∞–∫—Ä–∏—Ç—Ç—è –≤—ñ–¥–º—ñ–Ω–µ–Ω–æ, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è —Ç–∞–±–ª–∏—Ü—ñ","error",5e3),console.warn("–ü–æ–º–∏–ª–∫–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Ç–∞–±–ª–∏—Ü—ñ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä–∏—Ç—Ç—è–º:",c.errors),c.errors.forEach(u=>{console.warn(`  ‚Ä¢ ${u}`)}),s.disabled=!1;return}if(console.log("–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä–∏—Ç—Ç—è–º..."),(i=document.getElementById(V))==null||i.click(),!await U(t)){f("–°–∫–∞—Å–æ–≤–∞–Ω–æ –∑–∞–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É","warning"),s.disabled=!1;return}f("–ó–∞–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É...","info");const{data:g,error:m}=await _.from("sclad").select("sclad_id").eq("akt",t);if(m)throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞–ø–∏—Å–∏ —Å–∫–ª–∞–¥—É: "+m.message);const d=new Date().toISOString();if(g&&g.length>0){const{error:u}=await _.from("sclad").update({time_off:d}).eq("akt",t);if(u)throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–Ω–æ–≤–∏—Ç–∏ time_off: "+u.message)}const{error:w}=await _.from("acts").update({date_off:d,slusarsOn:!1}).eq("act_id",t);if(w)throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–∫—Ä–∏—Ç–∏ –∞–∫—Ç: "+w.message);try{await H(t),console.log(`‚úÖ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–±—ñ—Ç –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ –¥–ª—è –∞–∫—Ç—É #${t}`)}catch(u){console.error("‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ):",u)}const{date_on:y}=await v(t),h=A(y),b=A(d);if(h){const u=I();u.length&&await F({actId:t,dateKey:h,detailRows:u}),await x({actId:t,dateKey:h,dateClose:b})}else f("–ù–µ –≤–¥–∞–ª–æ—Å—å –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –¥–∞—Ç—É –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É ‚Äî –Ü—Å—Ç–æ—Ä—ñ—è –≤ shops –Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–∞","warning",2e3);$.isActClosed=!0,await D(),await O(t),E(),f("–ê–∫—Ç —É—Å–ø—ñ—à–Ω–æ –∑–∞–∫—Ä–∏—Ç–æ","success")}}catch(n){console.error("–ü–æ–º–∏–ª–∫–∞ –≤ –æ–±—Ä–æ–±–Ω–∏–∫—É —Å—Ç–∞—Ç—É—Å-–∑–∞–º–∫–∞:",n),f("–ü–æ–º–∏–ª–∫–∞: "+((n==null?void 0:n.message)||n),"error")}finally{s.disabled=!1}}}))}export{re as initStatusLockDelegation};
